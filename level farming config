--[[ Instructions
btw before you read anything this script was by bvth and updated by me fearthedestiny on dc
i made it delete the exp msgs in __DEBRIS and made it rejoin so less lag( rn fixed the rejoin) ok bye

stop script: [ _G.FARMING = false ]

PET_ID - the ID of the Pet to be levelled up  
CLEANER_PET_ID - the ID of the Pet that breaks unused coins that build up and are bad for farming, use some high-power pet like a Dominus Huge

# Best configuration for Pets leveled under 2,250,000 #
---
mineCoins = {"Christmas2 Small Coin"}
mineUnusedCoins = {"Christmas2 Coin", "Christmas2 Coin Stack", "Christmas2 Small Chest", "Christmas2 Chest"}
---

# Best configuration for Pets leveled above 2,250,000 #
---
CLEANER_PET_ID = 0
mineCoins = {"Christmas3 Small Cane", "Christmas3 Cane"}
mineUnusedCoins = {}
---
]]

-- Settings :

PET_ID = 57776465
CLEANER_PET_ID = 23848504
mineCoins = {"Christmas2 Small Coin"}
mineUnusedCoins = {"Christmas2 Coin", "Christmas2 Coin Stack", "Christmas2 Small Chest", "Christmas2 Chest"}
AUTO_REJOIN = true
REJOIN_INTERVAL = 300 -- in seconds (5 minutes)

--// Don't change anything under this line

function getLvl(ID)
    local Stats = workspace.__REMOTES.Core["Get Stats"]:InvokeServer()
    for _, pet in pairs(Stats.Save.Pets) do
        if pet.id == ID then
            local l = pet.l
            if pet.h then
                for _, h in pairs(Stats.Save.Hats) do
                    if h.id == pet.h then
                        l = l + h.l
                        break
                    end
                end
            end
            return l
        end
    end
end

local CLEANER_PET_LVL = getLvl(CLEANER_PET_ID)
local PET_LVL = getLvl(PET_ID)

task.wait(0.52)
_G.FARMING = true
local lastMainPetCooldwn, lastBreakPetCooldwn = os.clock(), os.clock()

-- Farming loop
task.spawn(function()
    repeat task.wait(0.13)
        for _, v in pairs(workspace.__THINGS.Coins:GetChildren()) do
            local cn = v:FindFirstChild("CoinName")
            if cn then
                if table.find(mineCoins, cn.Value) and os.clock() > lastMainPetCooldwn + 0.13 then
                    workspace.__REMOTES.Game.Coins:FireServer("Mine", v.Name, PET_LVL * 2 - 1, PET_ID)
                    lastMainPetCooldwn = os.clock()
                elseif table.find(mineUnusedCoins, cn.Value) and os.clock() > lastBreakPetCooldwn + 0.13 and CLEANER_PET_LVL then
                    workspace.__REMOTES.Game.Coins:FireServer("Mine", v.Name, CLEANER_PET_LVL * 2 - 1, CLEANER_PET_ID)
                    lastBreakPetCooldwn = os.clock()
                end
            end
        end
        if math.random(1000) == 1 then
            PET_LVL = getLvl(PET_ID)
        end
    until not _G.FARMING
end)

-- __DEBRIS cleaner loop
task.spawn(function()
    local debrisFolder = workspace:WaitForChild("__DEBRIS")
    while _G.FARMING do
        for _, item in ipairs(debrisFolder:GetChildren()) do
            if item:IsA("Part") then
                item:Destroy()
            end
        end
        task.wait(1)
    end
end)

-- Auto Rejoin (Infinite Yield Style)
if AUTO_REJOIN then
    task.spawn(function()
        local Players = game:GetService("Players")
        local TeleportService = game:GetService("TeleportService")
        local player = Players.LocalPlayer

        -- Wait until fully loaded
        if not game:IsLoaded() then
            game.Loaded:Wait()
        end

        -- Queue script on teleport (you MUST replace the link)
        if queue_on_teleport then
            queue_on_teleport('loadstring(game:HttpGet("https://github.com/4tcc/Lua/blob/main/level%20farming%20config"))()')
        end

        -- Wait and teleport
        while _G.FARMING and player and player.Parent do
            task.wait(REJOIN_INTERVAL)
            pcall(function()
                TeleportService:Teleport(game.PlaceId, player)
            end)
        end
    end)
end
